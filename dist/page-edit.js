!function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=18)}([function(e,t){e.exports=React},function(e,t,n){"use strict";function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return f}),n.d(t,"b",function(){return h});var i=n(0),s=n.n(i),l=n(15),u=(n.n(l),function e(t,n,a){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,a)}if("value"in r)return r.value;var i=r.get;return void 0!==i?i.call(a):void 0}),p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),f=function e(){o(this,e)};f.TEXT="text",f.NUMBER="number",f.DATE="date",f.DATE_RANGE="daterange",f.LINK="link",f.ADMIN_COMMENT="admincomment",f.ENUM="enum",f.FILE="file",f.GROUP="group",f.BOOLEAN="boolean",f.DISABLE="disable",f.STYLE_SELECT="styleselect";var h=function(){function e(){o(this,e)}return c(e,null,[{key:"renderField",value:function(e,t,n,a,r){var o=e+t.id,i={key:o,prefix:e,id:t.id,label:t.name,option:t.option,onChange:r};switch(t.type){case f.ADMIN_COMMENT:return s.a.createElement(d,p({},i,{label:t.option}));case f.DISABLE:return s.a.createElement(C,i);case f.TEXT:return s.a.createElement(g,p({},i,{value:n[o],masterValue:a[o]}));case f.NUMBER:var l={};if(/-/.test(t.option)){var u=t.option.split("-");l.min=u[0],l.max=u[1]}return s.a.createElement(y,p({},i,{value:n[o],masterValue:a[o],type:"number"},l));case f.DATE:return s.a.createElement(y,p({},i,{value:n[o],masterValue:a[o],type:"date"}));case f.LINK:return s.a.createElement(v,p({},i,{value:["",n[o+"_1"],n[o+"_2"]],masterValue:["",a[o+"_1"],a[o+"_2"]]}));case f.ENUM:return s.a.createElement(_,p({},i,{value:n[o],masterValue:a[o]}));case f.FILE:switch(t.option){case"image":return s.a.createElement(E,p({},i,{value:[n[o],n[o+"_1"],n[o+"_2"]],masterValue:[a[o],a[o+"_1"],a[o+"_2"]]}));default:return s.a.createElement(b,p({},i,{value:[n[o],n[o+"_1"]],masterValue:[a[o],a[o+"_1"]]}))}case f.BOOLEAN:return s.a.createElement(N,p({},i,{value:n[o],masterValue:a[o]}));case f.GROUP:return s.a.createElement(w,p({},i,{values:n,masterValues:a}));default:return s.a.createElement(O,i)}}}]),e}(),m=function(e){function t(e){o(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.onValueChange=n.onValueChange.bind(n);var r=""+n.props.prefix+n.props.id;return n.state={key:r,label:s.a.createElement("div",{className:"ui label"},n.props.label.replace("_"," ")),loading:!1},n}return r(t,e),c(t,[{key:"shouldComponentUpdate",value:function(e,t){return!e.value||e.value!==this.props.value}},{key:"onValueChange",value:function(e){this.props.onChange(e.target.name,e.target.value)}},{key:"getPlaceHolder",value:function(e,t){return""==e?t:e||t}}]),t}(s.a.Component),d=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"render",value:function(){var e=this.props.label.replace(/---/g,"");return s.a.createElement("div",{className:"input-"+f.ADMIN_COMMENT},s.a.createElement("h4",{className:"ui horizontal divider"},e))}}]),t}(s.a.Component),g=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"render",value:function(){var e=parseInt(this.props.option),t=this.getPlaceHolder(this.props.masterValue,""),n=e>64||e<=0?s.a.createElement("textarea",{onChange:this.onValueChange,name:this.state.key,value:this.props.value||"",placeholder:t}):s.a.createElement("input",{onChange:this.onValueChange,type:"text",name:this.state.key,value:this.props.value||"",placeholder:t});return s.a.createElement("li",{className:"input-"+f.TEXT},s.a.createElement("div",{className:"ui fluid labeled input"},this.state.label,n))}}]),t}(m),y=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"render",value:function(){var e=this.getPlaceHolder(this.props.masterValue,""),t=Object.assign({},this.props);return delete t.masterValue,delete t.option,s.a.createElement("li",{className:"input-"+this.props.htmlType},s.a.createElement("div",{className:"ui fluid labeled input"},this.state.label,s.a.createElement("input",p({},t,{onChange:this.onValueChange,name:this.state.key,value:this.props.value||"",placeholder:e}))))}}]),t}(m),v=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"render",value:function(){var e=this.getPlaceHolder(this.props.masterValue[1],"Label"),t=this.getPlaceHolder(this.props.masterValue[2],"http://");return s.a.createElement("li",{className:"input-"+f.LINK},s.a.createElement("div",{className:"ui fluid labeled icon input"},this.state.label,s.a.createElement("span",{className:"ui left icon input"},s.a.createElement("i",{className:"font icon"}),s.a.createElement("input",{type:"text",onChange:this.onValueChange,name:this.state.key+"_1",value:this.props.value[1]||"",placeholder:e})),s.a.createElement("span",{className:"ui left icon input"},s.a.createElement("i",{className:"linkify icon"}),s.a.createElement("input",{type:"text",onChange:this.onValueChange,name:this.state.key+"_2",value:this.props.value[2]||"",placeholder:t}))))}}]),t}(m),b=function(e){function t(e){o(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=p({},n.state,{fileData:"",progress:0,uploadedPath:"",urlBase:document.body.getAttribute("data-base")}),n.onFileSelect=n.onFileSelect.bind(n),n.onUpload=n.onUpload.bind(n),n.onTransferComplete=n.onTransferComplete.bind(n),n.onUploadProgress=n.onUploadProgress.bind(n),n}return r(t,e),c(t,[{key:"shouldComponentUpdate",value:function(e,n){return n!==this.state||u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"shouldComponentUpdate",this).call(this,e,n)}},{key:"onFileSelect",value:function(){var e=this,t=this.refs.file;if(t.files&&t.files[0]){var n=new FileReader;n.onload=function(t){e.setState({fileData:t.target.result}),e.onUpload()},n.readAsDataURL(t.files[0])}}},{key:"onUploadProgress",value:function(e){if(e.lengthComputable){var t=Math.floor(e.loaded/e.total*100);this.setState({progress:t})}}},{key:"onTransferComplete",value:function(e){var t=e.target.response;"success"===t.status?(this.setState({loading:!1,progress:100,uploadedPath:t.url}),this.props.onChange(this.state.key,t.url)):(this.setState({loading:!1,progress:0,uploadedPath:"",fileData:""}),console.log("upload Error"))}},{key:"onUpload",value:function(){var e=new FormData;e.append("file",this.refs.file.files[0]);var t=new XMLHttpRequest;t.responseType="json",t.addEventListener("load",this.onTransferComplete),t.upload.addEventListener("progress",this.onUploadProgress),t.open("POST",this.state.urlBase+"admin/page/upload.json"),t.send(e),this.setState({loading:!0})}},{key:"render",value:function(){var e=this.getPlaceHolder(this.props.masterValue[0],"File"),t=this.getPlaceHolder(this.props.masterValue[1],"Label"),n=null;return n=null===this.props.value[0]||""===this.props.value[0]?s.a.createElement("span",{className:"ui input file"},s.a.createElement("input",{type:"file",name:"file-"+this.state.key,ref:"file",onChange:this.onFileSelect})):this.state.progress>0&&this.state.progress<100?s.a.createElement("span",null,this.state.progress):s.a.createElement("span",null,s.a.createElement("div",{className:"ui input left icon"},s.a.createElement("i",{className:"icon file outline"}),s.a.createElement("input",{type:"text",onChange:this.onValueChange,name:this.state.key,value:this.props.value[0]||"",placeholder:e})),s.a.createElement("div",{className:"ui input left icon"},s.a.createElement("i",{className:"icon font"}),s.a.createElement("input",{type:"text",className:"label-text",onChange:this.onValueChange,name:this.state.key+"_1",value:this.props.value[1]||"",placeholder:t}))),s.a.createElement("li",{className:"input-"+f.FILE},s.a.createElement("div",{className:"ui labeled input"},this.state.label),n)}}]),t}(m),E=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"render",value:function(){var e=this.getPlaceHolder(this.props.masterValue[0],"File"),t=this.getPlaceHolder(this.props.masterValue[1],"alt"),n=this.getPlaceHolder(this.props.masterValue[2],"crop"),a=null,r=""===this.props.value[0]?null:this.props.value[0],o=r||this.props.masterValue[0]||"",i=""!==o?s.a.createElement("div",{className:"thumbnail",style:{backgroundImage:"url("+this.state.urlBase+"media/upload/"+o+")"}}):null;return a=void 0===this.props.value[0]||""===this.props.value[0]?s.a.createElement("span",null,s.a.createElement("div",{className:"ui input file"},s.a.createElement("input",{type:"file",name:"file-"+this.state.key,ref:"file",onChange:this.onFileSelect})),i):this.state.progress>0&&this.state.progress<100?s.a.createElement("span",null,this.state.progress):s.a.createElement("span",null,s.a.createElement("div",{className:"ui input left icon"},s.a.createElement("i",{className:"icon file image outline"}),s.a.createElement("input",{className:"pic-url",type:"text",onChange:this.onValueChange,name:this.state.key,value:this.props.value[0]||"",placeholder:e})),s.a.createElement("div",{className:"ui input left icon"},s.a.createElement("i",{className:"icon universal access"}),s.a.createElement("input",{className:"alt-text",type:"text",onChange:this.onValueChange,name:this.state.key+"_1",value:this.props.value[1]||"",placeholder:t})),s.a.createElement("div",{className:"ui input left icon"},s.a.createElement("i",{className:"icon crop"}),s.a.createElement("input",{className:"crop-setting",type:"text",onChange:this.onValueChange,name:this.state.key+"_2",value:this.props.value[2]||"",placeholder:n})),i),s.a.createElement("li",{className:"input-"+f.FILE},s.a.createElement("div",{className:"ui labeled input"},this.state.label),a)}}]),t}(b),_=function(e){function t(e){o(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.refreshDropdown=n.refreshDropdown.bind(n),n}return r(t,e),c(t,[{key:"refreshDropdown",value:function(e,t){var n=this;$(e).dropdown({onChange:function(e){n.props.onChange(t,e)}})}},{key:"componentDidMount",value:function(){this.refreshDropdown()}},{key:"componentDidUpdate",value:function(){this.refreshDropdown()}},{key:"render",value:function(){var e=this,t=this.props.option.split(",").map(function(e){if(/\:/.test(e)){var t=e.split(":");return s.a.createElement("div",{className:"item","data-value":t[0],key:e},t[1])}return s.a.createElement("div",{className:"item","data-value":e,key:e},e)});return s.a.createElement("li",{className:"input-"+f.ENUM},s.a.createElement("div",{className:"ui selection dropdown fluid",name:this.state.key,ref:function(t){return e.refreshDropdown(t,e.state.key)}},s.a.createElement("input",{type:"hidden",name:this.state.key,value:this.props.value}),s.a.createElement("i",{className:"dropdown icon"}),s.a.createElement("div",{className:"default text"},this.props.label),s.a.createElement("div",{className:"menu"},t)))}}]),t}(m),O=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"render",value:function(){return s.a.createElement("li",{className:"input-unknown"},s.a.createElement("div",null,"not implement : ",this.props.type))}}]),t}(m),w=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"render",value:function(){var e=this,t=this.props.masterValues["count"+this.props.id]||1;t=parseInt(t);for(var a=[],r=0;r<t;r++)!function(t){var r=e.props.id+"("+t+")",o=n.i(l.fromJS)(e.props.option),i=o.map(function(e){return e.set("id",r+"_"+e.get("id")).toJSON()}),u=i.map(function(t){return h.renderField(e.props.prefix,t,e.props.values,e.props.masterValues,e.props.onChange)});a[t]=s.a.createElement("li",{key:"group"+t,draggable:"true",className:"wide"},s.a.createElement("div",{className:"ui segment"},s.a.createElement("div",{className:"ui top left attached label theme"},e.state.key+"("+t+")"),s.a.createElement("ul",{className:"box"},u)))}(r);return s.a.createElement("li",{className:"input-"+f.GROUP},s.a.createElement("div",{className:"ui segment"},s.a.createElement("div",{className:"ui ribbon label teal"},this.props.label),s.a.createElement("div",{className:"ui input labeled"},s.a.createElement("div",{className:"ui label"},"count:"),s.a.createElement("input",{type:"number",name:"count"+this.props.id,min:"1",value:this.props.masterValues["count"+this.props.id]||1,onChange:this.onValueChange})),s.a.createElement("ul",{className:"box"},a)))}}]),t}(m),N=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"ui checkbox"},s.a.createElement("input",{id:this.state.key,name:this.state.key,type:"checkbox",checked:1==this.props.value,onChange:function(t){return e.props.onChange(e.state.key,t.target.checked?"1":"0")}}),s.a.createElement("label",{htmlFor:this.state.key},this.props.label))}}]),t}(m),C=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),c(t,[{key:"render",value:function(){return null}}]),t}(s.a.Component)},function(e,t){e.exports=ReactRedux},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n.n(r),i=n(16),s=n.n(i),l=n(7),u=n(14),p=n(2),c=(n.n(p),n(17)),f=(n.n(c),function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}()),h=function(){function e(){a(this,e);var t=this.getDefaultState();this.store=n.i(c.createStore)(n.i(u.a)(t)),this.render()}return f(e,[{key:"getDefaultState",value:function(){return Object.assign({},{campaign_name:"",campaign_shortname:"",campaign_id:"",session_id:"",languages:["en","tc"],masterLanguage:"en",editingLanguage:"en",city:"",page:{id:null,name:"",shortname:"",publish_start_date:"",publish_end_date:"",parent_id:"",order:1,hide:!1,member:!1,share:!0,pagetype_id:"1",layout_id:"0"},properties:{},fields:{en:{}},pagetype:[]},window.__PRELOADED_STATE__||{})}},{key:"render",value:function(){s.a.render(o.a.createElement(p.Provider,{store:this.store},o.a.createElement(l.a,null)),document.getElementById("root"))}}]),e}();t.default=h,new h},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=n(0),s=n.n(i),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=function(e){function t(){return a(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),l(t,[{key:"render",value:function(){var e=Object.assign({},this.props.state);return delete e.pagetype,delete e.hmr,delete e.campaign_name,delete e.campaign_shortname,delete e.campaign_id,delete e.session_id,delete e.languages,s.a.createElement("div",{className:"debugger"},JSON.stringify(e))}}]),t}(s.a.Component);t.a=u},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=n(0),s=n.n(i),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isLoading:!1,urlBase:document.body.getAttribute("data-base")},n.onSubmit=n.onSubmit.bind(n),n.onResult=n.onResult.bind(n),n.post=n.post.bind(n),n}return o(t,e),l(t,[{key:"onSubmit",value:function(e){e.preventDefault();var t=new FormData(e.target);this.post(t)}},{key:"post",value:function(e,t){var n=this;this.setState({isLoading:!0}),fetch(this.state.urlBase+(t||this.props.action||this.state.action)+".json",{credentials:"same-origin",method:"post",body:e}).then(function(e){return e.json()}).then(function(e){n.setState({isLoading:!1}),n.onResult(e)})}},{key:"onResultSuccess",value:function(e){this.props.onResultSuccess(e)}},{key:"onResultError",value:function(e){this.props.onResultError(e)}},{key:"onResult",value:function(e){var t=this;this.setState({error:null,isLoading:!1}),"success"===e.status?this.onResultSuccess(e):(this.onResultError(e),this.setState({error:e.code+e.info.message}),clearTimeout(this.iid),this.iid=setTimeout(function(){t.setState({error:""})},4e3))}}]),t}(s.a.Component);t.a=u},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=n(0),s=n.n(i),l=n(5),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},p=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=function e(t,n,a){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,a)}if("value"in r)return r.value;var i=r.get;return void 0!==i?i.call(a):void 0},f=function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onSave=n.onSave.bind(n),n.preview=n.preview.bind(n),n.state=u({},n.state,{isSaved:!1}),n}return o(t,e),p(t,[{key:"createPostData",value:function(){var e=new FormData,t={page_values:this.props.settings,field_values:this.props.fields,page_ext_values:this.props.properties};this.props.settings,e.append("source",JSON.stringify(t)),e.append("campaign",this.props.campaignId);for(var n in t.page_values)"pagetype_id"!==n&&"layout_id"!==n&&e.append(n,t.page_values[n]);return e.append("pagetype_id",this.props.settings.pagetype_id),e.append("layout_id",this.props.settings.layout_id),e.append("editing_language",this.props.editingLanguage),e}},{key:"onSave",value:function(){this.post(this.createPostData())}},{key:"preview",value:function(){var e=this,t="page/admin_preview"+(""===this.props.settings.id?"":"/"+this.props.settings.id);this.setState({isLoading:!0,isSaved:!1}),fetch(this.state.urlBase+t,{credentials:"same-origin",method:"post",body:this.createPostData()}).then(function(e){return e.text()}).then(function(t){e.setState({isLoading:!1}),e.props.onPreviewRender(t)})}},{key:"render",value:function(){var e="ui button"+(this.state.isLoading?" loading":"");return s.a.createElement("div",{id:"page-controls"},s.a.createElement("button",{className:e+" grey",onClick:this.preview},"Preview"),s.a.createElement("button",{className:e+" black",onClick:this.onSave},"Save"),this.state.isSaved?s.a.createElement("i",{className:"ui icon checkmark"}):null)}},{key:"onResultSuccess",value:function(e){var n=this;c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onResultSuccess",this).call(this,e),this.setState({isSaved:!0}),clearTimeout(this.iid),this.iid=setTimeout(function(){n.setState({isSaved:!1})},3e3)}}]),t}(l.a);t.a=f},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){return void 0===e||(e.constructor===Array?0===e.length:e.constructor===Object&&0===e.keys(e).length)}var s=n(0),l=n.n(s),u=n(2),p=(n.n(u),n(9)),c=n(13),f=n(10),h=n(12),m=n(8),d=n(6),g=n(11),y=n(4),v=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),b=function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={previewSource:""},n.onPreviewRender=n.onPreviewRender.bind(n),n}return o(t,e),v(t,[{key:"onPreviewRender",value:function(e){this.setState({previewSource:e})}},{key:"render",value:function(){for(var e=this,t=void 0,n=void 0,a=0;a<this.props.pagetype.length;a++){var r=this.props.pagetype[a];if(r.id===this.props.page.pagetype_id){t=r.properties,n=r.fields;break}}var o=Object.assign({},this.props.fields[this.props.editingLanguage]),s=Object.assign({},this.props.fields[this.props.masterLanguage]);return""!==this.state.previewSource?l.a.createElement("div",null,l.a.createElement("div",{className:"ui segment"},l.a.createElement("div",{className:"ui button",onClick:function(t){return e.setState({previewSource:""})}},"Close Preview")),l.a.createElement(g.a,{source:this.state.previewSource})):l.a.createElement("div",null,l.a.createElement("div",{className:"ui form"},l.a.createElement("div",{className:"ui segment inverted theme"},l.a.createElement("h1",null,this.props.campaignName),""===this.props.page.shortname?l.a.createElement("div",null," "):l.a.createElement("div",null,this.props.city+"_"+this.props.editingLanguage+"/"+this.props.campaignShortName+"/"+this.props.page.shortname)),l.a.createElement("div",{id:"page-content",className:"column"},l.a.createElement(h.a,{languages:this.props.languages,master:this.props.masterLanguage,current:this.props.editingLanguage,onChange:this.props.onLanguageChange}),l.a.createElement(m.a,{scheme:n||this.props.pagetype[0].fields,values:o,masterValues:s,prefix:"field",onChange:this.props.onInputChange}),l.a.createElement(d.a,{campaignId:this.props.campaignId,sessionId:this.props.sessionId,settings:this.props.page,fields:this.props.fields,properties:this.props.properties,onResultSuccess:this.props.onSaveSuccess,onResultError:this.props.onSaveError,onPreviewRender:this.onPreviewRender,editingLanguage:this.props.editingLanguage,action:"admin/page/save"+(""===this.props.page.id?"":"/"+this.props.page.id)})),l.a.createElement("div",{id:"page-setting",className:"column"},l.a.createElement("div",{className:"ui stacked segment inverted"},l.a.createElement("h3",null,l.a.createElement("i",{className:"icon setting"}),"Settings"),l.a.createElement("div",{id:"page-info"},l.a.createElement(c.a,{scheme:this.props.pagetype,selectedType:this.props.page.pagetype_id||1,selectedLayout:this.props.page.layout_id||0,onChange:this.props.onInputChange}),l.a.createElement(p.a,{campaignName:this.props.campaignName,page:this.props.page,onChange:this.props.onInputChange}))),l.a.createElement(f.a,{scheme:this.props.pagetype,selectedType:this.props.page.pagetype_id||1,selectedLayout:this.props.page.layout_id||0,onChange:this.props.onInputChange}),i(t)?null:l.a.createElement("div",{className:"ui segment"},l.a.createElement("h4",null,l.a.createElement("i",{className:"icon setting"}),"Additional Settings"),l.a.createElement(m.a,{scheme:t,values:this.props.properties,prefix:"prop",onChange:this.props.onInputChange})),l.a.createElement("div",{className:"ui segment"},l.a.createElement("h4",null,"Debug: state"),l.a.createElement(y.a,{state:this.props.debug}),l.a.createElement("h5",null,"TODO:"),l.a.createElement("ul",null,l.a.createElement("li",null,"Ordering of group items"),l.a.createElement("li",null,"Versioning"),l.a.createElement("li",null,"Auto save"),l.a.createElement("li",null,"reduce blank fields"),l.a.createElement("li",null,"Image crop"))))))}}]),t}(l.a.Component);t.a=n.i(u.connect)(function(e){return{hmr:e.hmr,campaignName:e.campaign_name,campaignId:e.campaign_id,campaignShortName:e.campaign_shortname,sessionId:e.session_id,languages:e.languages,masterLanguage:e.masterLanguage,editingLanguage:e.editingLanguage,pagetype:e.pagetype,page:e.page,properties:e.properties,fields:e.fields,city:e.city,debug:e}},function(e){return{onInputChange:function(t,n,a){switch(a){case"field":e({type:"CHANGE_FIELD_INPUT",payload:{name:t,value:n}});break;case"prop":e({type:"CHANGE_PROPERTIES_INPUT",payload:{name:t,value:n}});break;default:e({type:"CHANGE_PAGE_SETTING",payload:{name:t,value:n}})}},onLanguageChange:function(t){e({type:"CHANGE_EDITING_LANGUAGE",payload:t})},onSaveSuccess:function(t){e({type:"UPDATE_PAGE_ID",payload:t.page_id}),window.history.pushState({},"",t.url)},onSaveError:function(e){console.log(e)}}})(b)},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=n(0),s=n.n(i),l=n(1),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),p=function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n}return o(t,e),u(t,[{key:"onChange",value:function(e,t){this.props.onChange(e,t,this.props.prefix)}},{key:"render",value:function(){var e=this,t=Object.assign({},this.props.values),n=this.props.masterValues||this.props.values,a=this.props.scheme&&this.props.scheme.map(function(a){return l.b.renderField(e.props.prefix,a,t,n,e.onChange)});return s.a.createElement("ul",{className:"box page-fields"},a)}}]),t}(s.a.Component);t.a=p},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=n(0),s=n.n(i),l=n(1),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),p=function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onChange=n.onChange.bind(n),n.scheme=[{id:"name",name:"Name",type:l.a.DISABLE,option:"64"},{id:"shortname",name:"URL",type:l.a.TEXT,option:"64"},{id:"parent_id",name:"Parent Page",type:l.a.DISABLE,option:"64"},{id:"publish_start_date",name:"Publish Date",type:l.a.DATE,option:""},{id:"publish_end_date",name:"Expire Date",type:l.a.DATE,option:""},{id:"hide",name:"Hide",type:l.a.BOOLEAN,option:""},{id:"share",name:"Allow Share",type:l.a.BOOLEAN,option:""},{id:"member",name:"Members Only",type:l.a.BOOLEAN,option:""}],n}return o(t,e),u(t,[{key:"onChange",value:function(e,t){this.props.onChange(e,t,"")}},{key:"render",value:function(){var e=this,t={name:this.props.page.name,shortname:this.props.page.shortname,parent_id:this.props.page.parent_id,publish_start_date:this.props.page.publish_start_date,publish_end_date:this.props.page.publish_end_date,hide:this.props.page.hide||0,share:this.props.page.share||1,member:this.props.page.member||0},n=this.scheme.map(function(n){return l.b.renderField("",n,t,t,e.onChange)});return s.a.createElement("ul",{className:"box"},n)}}]),t}(s.a.Component);t.a=p},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=n(0),s=n.n(i),l=n(1),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),p=function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o=n.props.scheme.map(function(e){return e.id+":"+e.name});return n.scheme=[{id:"pagetype_id",name:"Type",type:l.a.ENUM,option:o.join(",")}],n.onChange=n.onChange.bind(n),n}return o(t,e),u(t,[{key:"onChange",value:function(e,t){""===t&&(t=0),this.props.onChange(e,t,"")}},{key:"render",value:function(){var e=this,t=(this.props.selectedType,this.props.selectedLayout,{});this.props.scheme.forEach(function(e){return t["type"+e.id]=parseInt(e.layout_count)});var n=t["type"+this.props.selectedType];return n<=1?null:s.a.createElement("div",{className:"ui segment inverted"},s.a.createElement("h4",null,s.a.createElement("i",{className:"icon setting"}),"Page Style Settings"),s.a.createElement("div",null,s.a.createElement("div",{className:"ui input labeled"},s.a.createElement("div",{className:"ui label"},"Layout"),s.a.createElement("input",{type:"number",min:"0",max:n-1,value:this.props.selectedLayout,onChange:function(t){return e.onChange("layout_id",t.target.value)}}))))}}]),t}(s.a.Component);t.a=p},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=n(0),s=n.n(i),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=function(e){function t(){return a(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),l(t,[{key:"render",value:function(){var e=this;return""===this.props.source?null:s.a.createElement("div",null,s.a.createElement("iframe",{id:"page-preview",ref:function(t){return t&&t.contentWindow.document.write(e.props.source)}}))}}]),t}(s.a.Component);t.a=u},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=n(0),s=n.n(i),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=function(e){function t(){return a(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),l(t,[{key:"onClick",value:function(e){this.props.onChange(e)}},{key:"render",value:function(){var e=this,t=this.props.languages.map(function(t){var n=[];return t==e.props.master&&n.push("master"),t==e.props.current&&n.push("active"),s.a.createElement("li",{key:t,className:n.join(" "),onClick:function(){return e.onClick(t)}},t)});return s.a.createElement("div",{id:"translations"},s.a.createElement("div",{className:"column"},s.a.createElement("div",{className:"ui right pointing label inverted theme"},"Translations")),s.a.createElement("div",{className:"column"},s.a.createElement("ul",{className:"box"},t)))}}]),t}(s.a.Component);t.a=u},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=n(0),s=n.n(i),l=n(1),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),p=function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o=n.props.scheme.map(function(e){return e.id+":"+e.name});return n.scheme=[{id:"pagetype_id",name:"Type",type:l.a.ENUM,option:o.join(",")}],n.onChange=n.onChange.bind(n),n}return o(t,e),u(t,[{key:"onChange",value:function(e,t){""===t&&(t=0),this.props.onChange(e,t,"")}},{key:"render",value:function(){var e=this,t={pagetype_id:this.props.selectedType,layout_id:this.props.selectedLayout||0},n=this.scheme.map(function(n){return l.b.renderField("",n,t,t,e.onChange)}),a={};return this.props.scheme.forEach(function(e){return a["type"+e.id]=parseInt(e.layout_count)}),s.a.createElement("ul",{className:"box"},n)}}]),t}(s.a.Component);t.a=p},function(e,t,n){"use strict";function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,n=arguments[1];switch(n.type){case"HOT_RELOAD":return o({},t,{hmr:Math.random()});case"CHANGE_EDITING_LANGUAGE":return t.editingLanguage===n.pagetype?t:o({},t,{editingLanguage:n.payload});case"CHANGE_FIELD_INPUT":if((t.fields[t.editingLanguage]&&t.fields[t.editingLanguage][n.payload.name])===n.payload.value)return t;if(0===n.payload.name.indexOf("field")){var a=r(t,t.editingLanguage,n.payload.name,n.payload.value);return Object.assign({},t,a)}if(0===n.payload.name.indexOf("count")){var i=r(t,t.masterLanguage,n.payload.name,n.payload.value);return Object.assign({},t,i)}return t;case"CHANGE_PROPERTIES_INPUT":if(t.properties[n.payload.name]===n.payload.value)return t;var s=Object.assign({},t.properties);return s[n.payload.name]=n.payload.value,o({},t,{properties:s});case"CHANGE_PAGE_SETTING":if(t.page[n.payload.name]===n.payload.value)return t;var l=Object.assign({},t);return l.page[n.payload.name]=n.payload.value,l;case"UPDATE_PAGE_ID":return t.page.id===n.payload?t:o({},t,{page:o({},t.page,{id:n.payload})});default:return t}}}function r(e,t,n,a){var r=Object.assign({},e.fields[t]);r[n]=a;var o=Object.assign({},e.fields);return o[t]=r,{fields:o}}t.a=a;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}},function(e,t){e.exports=Immutable},function(e,t){e.exports=ReactDOM},function(e,t){e.exports=Redux},function(e,t,n){e.exports=n(3)}]);